<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeCodeAuditor - Enhanced Compliance UI Test</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        const { AlertTriangle, CheckCircle, Info, XCircle, ChevronDown, ChevronUp, ExternalLink, Shield, BookOpen } = lucideReact;

        // Sample issue data with comprehensive compliance information
        const sampleIssues = [
            {
                rule_id: "nodejs_hardcoded_secrets",
                severity: "critical",
                category: "Security",
                message: "Hardcoded secret detected in source code. This exposes sensitive credentials.",
                file_path: "test.js",
                line_number: 13,
                code_snippet: "const DB_PASS = 'changeme123';",
                confidence: 0.95,
                metadata: {
                    iso27001: "A.9.4.3",
                    owasp: "A02-2021",
                    cwe: "CWE-798",
                    gdpr: "Art. 32"
                },
                standards: [
                    {
                        name: "ISO 27001",
                        section: "A.9.4.3 - Access Control",
                        description: "Privileged access rights shall be allocated and used on a restricted basis",
                        url: "https://www.iso.org/standard/54534.html"
                    },
                    {
                        name: "OWASP Top 10 2021",
                        section: "A02-2021 - Cryptographic Failures",
                        description: "Failures related to cryptography which often leads to sensitive data exposure",
                        url: "https://owasp.org/Top10/A02_2021-Cryptographic_Failures/"
                    },
                    {
                        name: "CWE",
                        section: "CWE-798 - Use of Hard-coded Credentials",
                        description: "The software contains hard-coded credentials, such as a password or cryptographic key",
                        url: "https://cwe.mitre.org/data/definitions/798.html"
                    }
                ],
                compliance_frameworks: [
                    "ISO 27001",
                    "GDPR",
                    "PCI DSS",
                    "HIPAA"
                ],
                remediation: "Remove hardcoded credentials and use environment variables or secure configuration management instead."
            },
            {
                rule_id: "express_cors_misconfiguration",
                severity: "high",
                category: "Security Configuration",
                message: "Permissive CORS configuration allows requests from any origin, potentially enabling cross-origin attacks.",
                file_path: "test.js",
                line_number: 12,
                code_snippet: "app.use(cors());",
                confidence: 0.88,
                metadata: {
                    iso27001: "A.13.1.1",
                    owasp: "A05-2021",
                    cwe: "CWE-346"
                },
                standards: [
                    {
                        name: "ISO 27001",
                        section: "A.13.1.1 - Network Controls",
                        description: "Network controls shall be managed and controlled to protect information",
                        url: "https://www.iso.org/standard/54534.html"
                    },
                    {
                        name: "OWASP Top 10 2021",
                        section: "A05-2021 - Security Misconfiguration",
                        description: "Security misconfiguration is commonly a result of insecure default configurations",
                        url: "https://owasp.org/Top10/A05_2021-Security_Misconfiguration/"
                    }
                ],
                compliance_frameworks: [
                    "ISO 27001",
                    "OWASP",
                    "PCI DSS"
                ],
                remediation: "Configure CORS to only allow specific trusted origins instead of using wildcard (*) or no restrictions."
            }
        ];

        const IssueCard = ({ issue, index }) => {
            const [showDetails, setShowDetails] = useState(false);

            const severityColors = {
                critical: 'text-red-600 bg-red-50 border-red-200',
                high: 'text-orange-600 bg-orange-50 border-orange-200',
                medium: 'text-yellow-600 bg-yellow-50 border-yellow-200',
                low: 'text-green-600 bg-green-50 border-green-200',
            };

            const severityIcons = {
                critical: XCircle,
                high: AlertTriangle,
                medium: Info,
                low: CheckCircle,
            };

            const Icon = severityIcons[issue.severity];

            // Helper function to render standards badges
            const renderStandardsBadges = () => {
                const badges = [];
                
                // Check metadata for quick standards references
                if (issue.metadata?.iso27001) {
                    badges.push(
                        React.createElement('span', {
                            key: "iso-meta",
                            className: "inline-flex items-center px-2 py-1 text-xs bg-red-100 text-red-800 rounded-full border border-red-200"
                        }, [
                            React.createElement(Shield, { key: "icon", className: "w-3 h-3 mr-1" }),
                            `ISO 27001: ${issue.metadata.iso27001}`
                        ])
                    );
                }
                
                if (issue.metadata?.owasp) {
                    badges.push(
                        React.createElement('span', {
                            key: "owasp-meta",
                            className: "inline-flex items-center px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded-full border border-orange-200"
                        }, [
                            React.createElement(Shield, { key: "icon", className: "w-3 h-3 mr-1" }),
                            `OWASP: ${issue.metadata.owasp}`
                        ])
                    );
                }
                
                if (issue.metadata?.cwe) {
                    badges.push(
                        React.createElement('span', {
                            key: "cwe-meta",
                            className: "inline-flex items-center px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full border border-blue-200"
                        }, [
                            React.createElement(BookOpen, { key: "icon", className: "w-3 h-3 mr-1" }),
                            issue.metadata.cwe
                        ])
                    );
                }
                
                if (issue.metadata?.gdpr) {
                    badges.push(
                        React.createElement('span', {
                            key: "gdpr-meta",
                            className: "inline-flex items-center px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full border border-green-200"
                        }, [
                            React.createElement(Shield, { key: "icon", className: "w-3 h-3 mr-1" }),
                            `GDPR: ${issue.metadata.gdpr}`
                        ])
                    );
                }

                return badges.length > 0 ? (
                    <div className="flex flex-wrap gap-2 mb-3">
                        {badges}
                    </div>
                ) : null;
            };

            // Helper function to render compliance frameworks
            const renderComplianceFrameworks = () => {
                if (!issue.compliance_frameworks || issue.compliance_frameworks.length === 0) return null;

                const frameworkColors = {
                    'ISO 27001': 'bg-red-100 text-red-700 border-red-200',
                    'OWASP': 'bg-orange-100 text-orange-700 border-orange-200',
                    'GDPR': 'bg-green-100 text-green-700 border-green-200',
                    'PCI DSS': 'bg-blue-100 text-blue-700 border-blue-200',
                    'HIPAA': 'bg-purple-100 text-purple-700 border-purple-200',
                    'NIST': 'bg-indigo-100 text-indigo-700 border-indigo-200',
                };

                return (
                    <div className="bg-red-50 border border-red-200 p-4 rounded-md mb-3">
                        <div className="flex items-center justify-between mb-3">
                            <p className="text-sm font-semibold text-red-900 flex items-center">
                                <AlertTriangle className="w-4 h-4 mr-2" />
                                Regulatory Compliance Impact
                            </p>
                            <span className="text-xs text-red-700 bg-red-100 px-2 py-1 rounded-full">
                                {issue.compliance_frameworks.length} framework{issue.compliance_frameworks.length !== 1 ? 's' : ''} affected
                            </span>
                        </div>
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-2">
                            {issue.compliance_frameworks.map((framework, idx) => {
                                const colorClass = frameworkColors[framework] || 'bg-gray-100 text-gray-700 border-gray-200';
                                return (
                                    <div key={idx} className={`px-3 py-2 text-sm rounded-md border ${colorClass} flex items-center justify-between`}>
                                        <div className="flex items-center space-x-2">
                                            <Shield className="w-3 h-3" />
                                            <span className="font-medium">{framework}</span>
                                        </div>
                                        <span className="text-xs opacity-75">Violation</span>
                                    </div>
                                );
                            })}
                        </div>
                        <div className="mt-3 p-2 bg-red-100 rounded text-xs text-red-800">
                            <strong>Impact:</strong> This security issue may result in non-compliance with the above regulatory frameworks, potentially leading to audit failures, penalties, or security breaches.
                        </div>
                    </div>
                );
            };

            return (
                <div className={`bg-white rounded-lg shadow-sm border-l-4 ${severityColors[issue.severity]} p-6 mb-4`}>
                    <div className="flex items-start space-x-4">
                        <Icon className={`h-6 w-6 mt-1 ${severityColors[issue.severity].split(' ')[0]}`} />
                        <div className="flex-1">
                            {/* Header */}
                            <div className="flex items-center justify-between mb-2">
                                <h3 className="text-lg font-semibold text-gray-900">{issue.rule_id}</h3>
                                <div className="flex items-center space-x-2">
                                    <span className={`px-2 py-1 text-xs font-medium rounded-full ${severityColors[issue.severity]}`}>
                                        {issue.severity.toUpperCase()}
                                    </span>
                                    <span className="px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800">
                                        {issue.category}
                                    </span>
                                    {(issue.standards && issue.standards.length > 0) && (
                                        <span className="px-2 py-1 text-xs font-medium rounded-full bg-purple-100 text-purple-800 flex items-center">
                                            <Shield className="w-3 h-3 mr-1" />
                                            {issue.standards.length} Standards
                                        </span>
                                    )}
                                    {(issue.compliance_frameworks && issue.compliance_frameworks.length > 0) && (
                                        <span className="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800 flex items-center">
                                            <AlertTriangle className="w-3 h-3 mr-1" />
                                            {issue.compliance_frameworks.length} Compliance
                                        </span>
                                    )}
                                </div>
                            </div>

                            {/* Quick Compliance Summary */}
                            {(issue.compliance_frameworks?.length > 0 || issue.standards?.length > 0) && (
                                <div className="bg-yellow-50 border border-yellow-200 p-3 rounded-md mb-3">
                                    <div className="flex items-start space-x-2">
                                        <AlertTriangle className="w-4 h-4 text-yellow-600 mt-0.5 flex-shrink-0" />
                                        <div className="text-sm">
                                            <span className="font-medium text-yellow-800">Compliance Alert:</span>
                                            <span className="text-yellow-700 ml-1">
                                                This issue violates {issue.compliance_frameworks?.length || 0} regulatory framework{(issue.compliance_frameworks?.length || 0) !== 1 ? 's' : ''} 
                                                {issue.standards?.length > 0 && ` and ${issue.standards.length} security standard${issue.standards.length !== 1 ? 's' : ''}`}.
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {/* Standards badges */}
                            {renderStandardsBadges()}

                            {/* Message */}
                            <p className="text-gray-700 mb-3">{issue.message}</p>

                            {/* File info */}
                            <div className="text-sm text-gray-600 mb-3">
                                <span className="font-medium">File:</span> {issue.file_path}
                                {issue.line_number && (
                                    <>
                                        <span className="mx-2">•</span>
                                        <span className="font-medium">Line:</span> {issue.line_number}
                                    </>
                                )}
                            </div>

                            {/* Code snippet */}
                            {issue.code_snippet && (
                                <div className="bg-gray-50 p-3 rounded-md mb-3">
                                    <p className="text-sm font-medium text-gray-700 mb-1">Code:</p>
                                    <code className="text-sm text-gray-800 font-mono">{issue.code_snippet}</code>
                                </div>
                            )}

                            {/* Show/Hide Details Button */}
                            <button
                                onClick={() => setShowDetails(!showDetails)}
                                className="flex items-center space-x-2 text-sm text-blue-600 hover:text-blue-800 mb-3"
                            >
                                {showDetails ? <ChevronUp className="w-4 h-4" /> : <ChevronDown className="w-4 h-4" />}
                                <span>{showDetails ? 'Hide' : 'Show'} Standards & Compliance Details</span>
                            </button>

                            {/* Detailed compliance info - collapsible */}
                            {showDetails && (
                                <div className="space-y-3">
                                    {renderComplianceFrameworks()}
                                </div>
                            )}

                            {/* Remediation */}
                            {issue.remediation && (
                                <div className="bg-blue-50 p-3 rounded-md">
                                    <p className="text-sm font-medium text-blue-800 mb-1 flex items-center">
                                        <CheckCircle className="w-4 h-4 mr-2" />
                                        Remediation
                                    </p>
                                    <p className="text-sm text-blue-700">{issue.remediation}</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            return (
                <div className="max-w-4xl mx-auto">
                    <div className="mb-8">
                        <h1 className="text-3xl font-bold text-gray-900 mb-2">VibeCodeAuditor - Enhanced Compliance UI</h1>
                        <p className="text-gray-600">Testing enhanced issue cards with comprehensive compliance standards display</p>
                    </div>

                    <div className="mb-6 bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                        <div className="flex items-center mb-4">
                            <Shield className="h-5 w-5 text-purple-600 mr-2" />
                            <h2 className="text-lg font-semibold text-gray-900">Compliance Impact Overview</h2>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div className="bg-red-50 border border-red-200 p-3 rounded-md">
                                <div className="flex items-center justify-between">
                                    <span className="text-sm font-medium text-red-900">ISO 27001</span>
                                    <span className="text-sm font-bold text-red-700">2 violations</span>
                                </div>
                            </div>
                            <div className="bg-orange-50 border border-orange-200 p-3 rounded-md">
                                <div className="flex items-center justify-between">
                                    <span className="text-sm font-medium text-orange-900">OWASP</span>
                                    <span className="text-sm font-bold text-orange-700">2 violations</span>
                                </div>
                            </div>
                            <div className="bg-blue-50 border border-blue-200 p-3 rounded-md">
                                <div className="flex items-center justify-between">
                                    <span className="text-sm font-medium text-blue-900">PCI DSS</span>
                                    <span className="text-sm font-bold text-blue-700">2 violations</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="space-y-4">
                        {sampleIssues.map((issue, index) => (
                            <IssueCard key={index} issue={issue} index={index} />
                        ))}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>